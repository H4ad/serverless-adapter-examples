export const id=42;export const ids=[42];export const modules={5228:(e,t,r)=>{r.d(t,{b:()=>n});const n="4.2.1"},19042:(e,t,r)=>{r.r(t),r.d(t,{ApolloServerPluginUsageReporting:()=>F});var n=r(40279),s=r(53488),o=r(72047),a=r(8530),i=r(53357),c=r(36292),u=r(22037),l=r(73837),h=r(59796),p=r(13321),d=r(58289),y=r(52718);function f(e,t,r){const n=r?new T:b;e.root&&m(e.root,n,t)||!e.queryPlan||g(e.queryPlan,n,t)}function g(e,t,r){return!!e&&(e.fetch?.trace?.root&&e.fetch.serviceName?m(e.fetch.trace.root,t.child(`service:${e.fetch.serviceName}`),r):e.flatten?.node?g(e.flatten.node,t,r):e.parallel?.nodes?e.parallel.nodes.some((e=>g(e,t,r))):!!e.sequence?.nodes&&e.sequence.nodes.some((e=>g(e,t,r))))}function m(e,t,r){return!!r(e,t)||(e.child?.some((e=>m(e,e.responseName?t.child(e.responseName):t,r)))??!1)}const b={toArray(){throw Error("not collecting paths!")},child(){return this}};class T{toArray(){return[]}child(e){return new C(e,this)}}class C{constructor(e,t){this.responseName=e,this.prev=t}toArray(){const e=[];let t=this;for(;t instanceof C;)e.push(t.responseName),t=t.prev;return e.reverse()}child(e){return new C(e,this)}}class w{toArray(){let e=0;const t=[];for(const r of this.buckets)0===r?e++:(1===e?t.push(0):0!==e&&t.push(-e),t.push(Math.floor(r)),e=0);return t}static durationToBucket(e){const t=Math.log(e/1e3),r=Math.ceil(t/w.EXPONENT_LOG);return r<=0||Number.isNaN(r)?0:r>=w.BUCKET_COUNT?w.BUCKET_COUNT-1:r}incrementDuration(e,t=1){return this.incrementBucket(w.durationToBucket(e),t),this}incrementBucket(e,t=1){if(e>=w.BUCKET_COUNT)throw Error("Bucket is out of bounds of the buckets array");if(e>=this.buckets.length){const t=this.buckets.length;this.buckets.length=e+1,this.buckets.fill(0,t)}this.buckets[e]+=t}combine(e){for(let t=0;t<e.buckets.length;t++)this.incrementBucket(t,e.buckets[t])}constructor(e){const t=e?.initSize||74,r=e?.buckets,n=Math.max(r?.length||0,t);this.buckets=Array(n).fill(0),r&&r.forEach(((e,t)=>this.buckets[t]=e))}}function S({logger:e}){let t,r=0;return new y({sizeCalculation:e=>Buffer.byteLength(JSON.stringify(e),"utf8"),maxSize:10*Math.pow(2,20),dispose(){r++,(!t||(new Date).getTime()-t.getTime()>6e4)&&(t=new Date,e.warn(["This server is processing a high number of unique operations.  ",`A total of ${r} records have been `,"ejected from the ApolloServerPluginUsageReporting signature cache in the past ","interval.  If you see this warning frequently, please open an ","issue on the Apollo Server repository."].join("")),r=0)}})}w.BUCKET_COUNT=384,w.EXPONENT_LOG=Math.log(1.1);class v{constructor(){this.bytes=0}}class E{constructor(e){this.header=e,this.tracesPerQuery=Object.create(null),this.endTime=null,this.operationCount=0,this.sizeEstimator=new v}ensureCountsAreIntegers(){for(const e of Object.values(this.tracesPerQuery))e.ensureCountsAreIntegers()}addTrace({statsReportKey:e,trace:t,asTrace:r,referencedFieldsByType:s,maxTraceBytes:o=10485760}){const a=this.getTracesAndStats({statsReportKey:e,referencedFieldsByType:s});if(r){const e=n.fM.encode(t).finish();!isNaN(o)&&e.length>o?a.statsWithContext.addTrace(t,this.sizeEstimator):(a.trace.push(e),this.sizeEstimator.bytes+=2+e.length)}else a.statsWithContext.addTrace(t,this.sizeEstimator)}getTracesAndStats({statsReportKey:e,referencedFieldsByType:t}){const r=this.tracesPerQuery[e];if(r)return r;this.sizeEstimator.bytes+=I(e);for(const[e,r]of Object.entries(t)){this.sizeEstimator.bytes+=4,r.isInterface&&(this.sizeEstimator.bytes+=2),this.sizeEstimator.bytes+=I(e);for(const e of r.fieldNames)this.sizeEstimator.bytes+=I(e)}return this.tracesPerQuery[e]=new N(t)}}class N{constructor(e){this.referencedFieldsByType=e,this.trace=[],this.statsWithContext=new O,this.internalTracesContributingToStats=[]}ensureCountsAreIntegers(){this.statsWithContext.ensureCountsAreIntegers()}}class O{constructor(){this.map=Object.create(null)}toArray(){return Object.values(this.map)}ensureCountsAreIntegers(){for(const e of Object.values(this.map))e.ensureCountsAreIntegers()}addTrace(e,t){this.getContextualizedStats(e,t).addTrace(e,t)}getContextualizedStats(e,t){const r={clientName:e.clientName,clientVersion:e.clientVersion},n=JSON.stringify(r),s=this.map[n];if(s)return s;t.bytes+=20+I(e.clientName)+I(e.clientVersion);const o=new A(r);return this.map[n]=o,o}}class A{constructor(e){this.context=e,this.queryLatencyStats=new P,this.perTypeStat=Object.create(null)}ensureCountsAreIntegers(){for(const e of Object.values(this.perTypeStat))e.ensureCountsAreIntegers()}addTrace(e,t){const{fieldExecutionWeight:r}=e;if(r||this.queryLatencyStats.requestsWithoutFieldInstrumentation++,this.queryLatencyStats.requestCount++,e.fullQueryCacheHit?(this.queryLatencyStats.cacheLatencyCount.incrementDuration(e.durationNs),this.queryLatencyStats.cacheHits++):this.queryLatencyStats.latencyCount.incrementDuration(e.durationNs),!e.fullQueryCacheHit&&null!=e.cachePolicy?.maxAgeNs)switch(e.cachePolicy.scope){case n.fM.CachePolicy.Scope.PRIVATE:this.queryLatencyStats.privateCacheTtlCount.incrementDuration(e.cachePolicy.maxAgeNs);break;case n.fM.CachePolicy.Scope.PUBLIC:this.queryLatencyStats.publicCacheTtlCount.incrementDuration(e.cachePolicy.maxAgeNs)}e.persistedQueryHit&&this.queryLatencyStats.persistedQueryHits++,e.persistedQueryRegister&&this.queryLatencyStats.persistedQueryMisses++,e.forbiddenOperation&&this.queryLatencyStats.forbiddenOperationCount++,e.registeredOperation&&this.queryLatencyStats.registeredOperationCount++;let s=!1;f(e,((e,n)=>{if(e.error?.length){s=!0;let r=this.queryLatencyStats.rootErrorStats;n.toArray().forEach((e=>{r=r.getChild(e,t)})),r.requestsWithErrorsCount+=1,r.errorsCount+=e.error.length}if(r){const n=e.originalFieldName||e.responseName;if(e.parentType&&n&&e.type&&null!=e.endTime&&null!=e.startTime&&e.endTime>=e.startTime){const s=this.getTypeStat(e.parentType,t).getFieldStat(n,e.type,t);s.errorsCount+=e.error?.length??0,s.observedExecutionCount++,s.estimatedExecutionCount+=r,s.requestsWithErrorsCount+=(e.error?.length??0)>0?1:0,s.latencyCount.incrementDuration(e.endTime-e.startTime,r)}}return!1}),!0),s&&this.queryLatencyStats.requestsWithErrorsCount++}getTypeStat(e,t){const r=this.perTypeStat[e];if(r)return r;t.bytes+=I(e);const n=new q;return this.perTypeStat[e]=n,n}}class P{constructor(){this.latencyCount=new w,this.requestCount=0,this.requestsWithoutFieldInstrumentation=0,this.cacheHits=0,this.persistedQueryHits=0,this.persistedQueryMisses=0,this.cacheLatencyCount=new w,this.rootErrorStats=new x,this.requestsWithErrorsCount=0,this.publicCacheTtlCount=new w,this.privateCacheTtlCount=new w,this.registeredOperationCount=0,this.forbiddenOperationCount=0}}class x{constructor(){this.children=Object.create(null),this.errorsCount=0,this.requestsWithErrorsCount=0}getChild(e,t){const r=this.children[e];if(r)return r;const n=new x;return this.children[e]=n,t.bytes+=I(e)+4,n}}class q{constructor(){this.perFieldStat=Object.create(null)}getFieldStat(e,t,r){const n=this.perFieldStat[e];if(n)return n;r.bytes+=I(e)+I(t)+10;const s=new R(t);return this.perFieldStat[e]=s,s}ensureCountsAreIntegers(){for(const e of Object.values(this.perFieldStat))e.ensureCountsAreIntegers()}}class R{constructor(e){this.returnType=e,this.errorsCount=0,this.observedExecutionCount=0,this.estimatedExecutionCount=0,this.requestsWithErrorsCount=0,this.latencyCount=new w}ensureCountsAreIntegers(){this.estimatedExecutionCount=Math.floor(this.estimatedExecutionCount)}}function I(e){return 2+Buffer.byteLength(e)}var k=r(5228),L=r(8460),M=r(95721);const U=(0,l.promisify)(h.gzip),B={hostname:u.hostname(),agentVersion:`@apollo/server@${k.b}`,runtimeVersion:`node ${process.version}`,uname:`${u.platform()}, ${u.type()}, ${u.release()}, ${u.arch()})`};function F(e=Object.create(null)){const t=e.fieldLevelInstrumentation,r="number"==typeof t?async()=>Math.random()<t?1/t:0:t||(async()=>!0);let u=null;return(0,p.U)({__internal_plugin_id__:"UsageReporting",__is_disabled_plugin__:!1,requestDidStart:async e=>u?u(e):{},async serverWillStart({logger:t,apollo:l,startedInBackground:h,schema:p}){const g=e.logger??t,{key:m,graphRef:b}=l;if(!m||!b)throw new Error("You've enabled usage reporting via ApolloServerPluginUsageReporting, but you also need to provide your Apollo API key and graph ref, via the APOLLO_KEY/APOLLO_GRAPH_REF environment variables or via `new ApolloServer({apollo: {key, graphRef})`.");if((0,M.X)(p)){if(e.__onlyIfSchemaIsNotSubgraph)return g.warn("You have specified an Apollo API key and graph ref but this server appears to be a subgraph. Typically usage reports are sent to Apollo by your Router or Gateway, not directly from your subgraph; usage reporting is disabled. To enable usage reporting anyway, explicitly install `ApolloServerPluginUsageReporting`. To disable this warning, install `ApolloServerPluginUsageReportingDisabled`."),{};g.warn("You have installed `ApolloServerPluginUsageReporting` but this server appears to be a subgraph. Typically usage reports are sent to Apollo by your Router or Gateway, not directly from your subgraph. If this was unintentional, remove `ApolloServerPluginUsageReporting` from your server's `plugins` array.")}g.info(`Apollo usage reporting starting! See your graph at https://studio.apollographql.com/graph/${encodeURI(b)}/`);const T=e.sendReportsImmediately??h;let C=null;const v=new Map,N=e=>{const t=v.get(e);if(t)return t;const r=new E(new n.UD({...B,executableSchemaId:e,graphRef:b}));return v.set(e,r),r},O=e.overrideReportedSchema?(0,L.n)(e.overrideReportedSchema):void 0;let A,P;T||(P=setInterval((()=>k()),e.reportIntervalMs||1e4));let x=e.sendTraces??!0;const q=e.experimental_sendOperationAsTrace??function(){const e=new y({maxSize:Math.pow(2,20),sizeCalculation:(e,t)=>t&&Buffer.byteLength(t)||0});return(t,r)=>{const n=t.endTime?.seconds;if(null==n)throw Error("programming error: endTime not set on trace");const s=function(e){let t=!1;return f(e,(function(e){return(e.error?.length??0)>0&&(t=!0),t}),!1),t}(t),o=JSON.stringify([r,w.durationToBucket(t.durationNs),Math.floor(n/60),s?Math.floor(n/5):""]);return!e.get(o)&&(e.set(o,!0),!0)}}();let R=!1;function I(e){if(A?.executableSchema===e)return A.executableSchemaId;const t=(0,L.n)((0,a.t3)(e));return A={executableSchema:e,executableSchemaId:t},t}async function k(){await Promise.all([...v.keys()].map((e=>F(e))))}async function F(t){return H(t).catch((t=>{e.reportErrorFunction?e.reportErrorFunction(t):g.error(t.message)}))}const H=async t=>{let r=(e=>{const t=v.get(e);return t?(v.delete(e),t):null})(t);if(!r||0===Object.keys(r.tracesPerQuery).length&&0===r.operationCount)return;r.endTime=(0,d.F)(new Date),r.ensureCountsAreIntegers();const s=n.yG.verify(r);if(s)throw new Error(`Error verifying report: ${s}`);let a=n.yG.encode(r).finish();if(r=null,e.debugPrintReports){const e=n.yG.decode(a);g.info(`Apollo usage report: ${JSON.stringify(e.toJSON())}`)}const u=await U(a);a=null;const l=e.fetcher??c.default,h=await o((async()=>{const t=new i.AbortController,r=setTimeout((()=>{t.abort()}),e.requestTimeoutMs??3e4);let n;try{n=await l((e.endpointUrl||"https://usage-reporting.api.apollographql.com")+"/api/ingress/traces",{method:"POST",headers:{"user-agent":"ApolloServerPluginUsageReporting","x-api-key":m,"content-encoding":"gzip",accept:"application/json"},body:u,signal:t.signal})}finally{clearTimeout(r)}if(n.status>=500&&n.status<600)throw new Error(`HTTP status ${n.status}, ${await n.text()||"(no body)"}`);return n}),{retries:(e.maxAttempts||5)-1,minTimeout:e.minimumRetryDelayMs||100,factor:2}).catch((e=>{throw new Error(`Error sending report to Apollo servers: ${e.message}`)}));if(h.status<200||h.status>=300)throw new Error(`Error sending report to Apollo servers: HTTP status ${h.status}, ${await h.text()||"(no body)"}`);if(x&&200===h.status&&h.headers.get("content-type")?.match(/^\s*application\/json\s*(?:;|$)/i)){const e=await h.text();let t;try{t=JSON.parse(e)}catch(e){throw new Error(`Error parsing response from Apollo servers: ${e}`)}!0===t.tracesIgnored&&(g.debug("This graph's organization does not have access to traces; sending all subsequent operations as stats."),x=!1)}e.debugPrintReports&&g.info(`Apollo usage report: status ${h.status}`)};return u=({metrics:t,schema:o,request:{http:a,variables:i}})=>{const c=new d.X({maskedBy:"ApolloServerPluginUsageReporting",sendErrors:e.sendErrors,logger:g});c.startTiming(),t.startHrTime=c.startHrTime;let u=!1,l=!1,h=null;async function p(t){null===h&&("function"==typeof e.includeRequest?(h=await e.includeRequest(t),"boolean"!=typeof h&&(g.warn("The 'includeRequest' async predicate function must return a boolean value."),h=!0)):h=!0)}a&&(c.trace.http=new n.fM.HTTP({method:n.fM.HTTP.Method[a.method]||n.fM.HTTP.Method.UNKNOWN,host:null,path:null}),e.sendHeaders&&function(e,t,r){if(!(!r||"none"in r&&r.none||"all"in r&&!r.all))for(const[s,o]of t)if(!("exceptNames"in r&&r.exceptNames.some((e=>e.toLowerCase()===s))||"onlyNames"in r&&!r.onlyNames.some((e=>e.toLowerCase()===s))))switch(s){case"authorization":case"cookie":case"set-cookie":break;default:e.requestHeaders[s]=new n.fM.HTTP.Values({value:[o]})}}(c.trace.http,a.headers,e.sendHeaders));let y=!1;return{async didResolveSource(r){y=!0,t.persistedQueryHit&&(c.trace.persistedQueryHit=!0),t.persistedQueryRegister&&(c.trace.persistedQueryRegister=!0),i&&(c.trace.details=function(e,t,r){const s=new n.fM.Details,o=(()=>{if(!t||!("transform"in t))return e;{const n=Object.keys(e);try{return function(e,t){const r=Object.create(null);return e.forEach((e=>{r[e]=t[e]})),r}(n,t.transform({variables:e,operationString:r}))}catch(e){return function(e){const t=Object.create(null);return e.forEach((e=>{t[e]="[PREDICATE_FUNCTION_ERROR]"})),t}(n)}}})();return Object.keys(o).forEach((e=>{if(!t||"none"in t&&t.none||"all"in t&&!t.all||"exceptNames"in t&&t.exceptNames.includes(e)||"onlyNames"in t&&!t.onlyNames.includes(e))s.variablesJson[e]="";else try{s.variablesJson[e]=void 0===o[e]?"":JSON.stringify(o[e])}catch(t){s.variablesJson[e]=JSON.stringify("[Unable to convert value to JSON]")}})),s}(i,e.sendVariableValues,r.source));const s=(e.generateClientInfo||_)(r);if(s){const{clientName:e,clientVersion:t}=s;c.trace.clientVersion=t||"",c.trace.clientName=e||""}},validationDidStart:async()=>async e=>{u=!!e&&0!==e.length},async didResolveOperation(e){if(l=void 0===e.operation,await p(e),h&&!l&&void 0===t.captureTraces){const n=await r(e);c.trace.fieldExecutionWeight="number"==typeof n?n:n?1:0,t.captureTraces=!!c.trace.fieldExecutionWeight}},async executionDidStart(){if(t.captureTraces)return{willResolveField:({info:e})=>c.willResolveField(e)}},async didEncounterSubsequentErrors(e,t){c.didEncounterErrors(t)},async willSendSubsequentPayload(e,t){t.hasNext||await f(e)},async willSendResponse(e){y&&(e.errors&&c.didEncounterErrors(e.errors),"single"===e.response.body.kind&&await f(e))}};async function f(r){const a=!!r.operation;await p(r),c.stopTiming();const i=O??I(o);if(!1===h)return void(a&&N(i).operationCount++);c.trace.fullQueryCacheHit=!!t.responseCacheHit,c.trace.forbiddenOperation=!!t.forbiddenOperation,c.trace.registeredOperation=!!t.registeredOperation;const d=r.overallCachePolicy.policyIfCacheable();d&&(c.trace.cachePolicy=new n.fM.CachePolicy({scope:"PRIVATE"===d.scope?n.fM.CachePolicy.Scope.PRIVATE:"PUBLIC"===d.scope?n.fM.CachePolicy.Scope.PUBLIC:n.fM.CachePolicy.Scope.UNKNOWN,maxAgeNs:1e9*d.maxAge})),t.queryPlanTrace&&(c.trace.queryPlan=t.queryPlanTrace),async function(){if(R)return;await new Promise((e=>setImmediate(e)));const i=O??I(o),{trace:h}=c;let p,d;r.document?u?p="## GraphQLValidationFailure\n":l&&(p="## GraphQLUnknownOperationName\n"):p="## GraphQLParseFailure\n";const y=void 0===p;if(p)e.sendUnexecutableOperationDocuments&&(h.unexecutedOperationBody=r.source,h.unexecutedOperationName=r.request.operationName||""),d=Object.create(null);else{const t=function(){if(!r.document)throw new Error("No document?");const t=`${r.queryHash}${(n=r.operationName||"")&&":"+n}`;var n;C&&C.forSchema===o||(C={forSchema:o,cache:S({logger:g})});const a=C.cache.get(t);if(a)return a;const i={signature:(e.calculateSignature||s.usageReportingSignature)(r.document,r.operationName||""),referencedFieldsByType:(0,s.calculateReferencedFieldsByType)({document:r.document,schema:o,resolvedOperationName:r.operationName??null})};return C.cache.set(t,i),i}();p=`# ${r.operationName||"-"}\n${t.signature}`,d=t.referencedFieldsByType}const f=n.fM.verify(h);if(f)throw new Error(`Error encoding trace: ${f}`);a&&N(i).operationCount++,N(i).addTrace({statsReportKey:p,trace:h,asTrace:x&&(!y||!!t.captureTraces)&&q(h,p),referencedFieldsByType:d}),(T||N(i).sizeEstimator.bytes>=(e.maxUncompressedReportSize||4194304))&&await F(i)}().catch(g.error)}},{async serverWillStop(){P&&(clearInterval(P),P=void 0),R=!0,await k()}}}})}function _({request:e}){const t="apollographql-client-name",r="apollographql-client-version";return e.http?.headers?.get(t)||e.http?.headers?.get(r)?{clientName:e.http?.headers?.get(t),clientVersion:e.http?.headers?.get(r)}:e.extensions?.clientInfo?e.extensions.clientInfo:{}}},8460:(e,t,r)=>{r.d(t,{n:()=>s});var n=r(15743);function s(e){return(0,n.createHash)("sha256").update(e).digest("hex")}}};